# **产品需求文档 (PRD): 实时字幕翻译工具**

| **版本** | **日期** | **作者** | **变更描述** |
| :--- | :--- | :--- | :--- |
| 1.0 | 2025-07-22 | AI 助手 | 初始版本创建 |

## 1. 产品概述

### 1.1. 项目简介

**实时字幕翻译工具**是一款专为 macOS 用户设计的桌面应用程序，旨在消除跨语言沟通障碍。它能够实时捕捉系统内部或外部麦克风的英文音频，通过先进的语音识别和机器翻译技术，将其转换成中文字幕，并以一个可定制的悬浮窗口形式呈现在用户桌面上。

本工具适用于多种场景，如观看无字幕的在线视频、参加英文网络会议、收听英文播客等，帮助用户即时理解外语内容。

### 1.2. 目标用户

*   **学生与研究人员**：观看在线课程、学术讲座时，辅助理解。
*   **职场人士**：参加跨国会议、观看行业分享时，实时获取信息。
*   **内容消费者**：观看国外直播、视频播客等流媒体内容。
*   **有听力障碍但懂中文的用户**：将语音内容转换为文字，辅助理解。

### 1.3. 核心价值

*   **实时性**：提供低于500ms的低延迟翻译，保证信息获取的同步性。
*   **高质量翻译**：集成业界领先的 AI 翻译服务（OpenAI GPT & Kimi AI），确保翻译的准确性和流畅性。
*   **易用性**：简洁的安装配置流程和直观的操作界面，用户可快速上手。
*   **高度可定制**：用户可根据个人偏好调整字幕样式、翻译引擎、识别模型等，满足个性化需求。

## 2. 功能需求 (Functional Requirements)

### 2.1. 核心功能

| **ID** | **功能名称** | **描述** | **优先级** |
| :--- | :--- | :--- | :--- |
| F-001 | **实时音频捕捉** | - 程序必须能够从用户指定的音频设备（如系统内置的 BlackHole 虚拟声卡）捕捉实时音频流。<br>- 支持配置采样率（`SAMPLE_RATE`）和音频块大小（`CHUNK_SIZE`）。 | **高** |
| F-002 | **语音识别 (ASR)** | - 使用 OpenAI Whisper 模型将捕捉到的英文音频流实时转换为文本。<br>- 用户可配置使用的 Whisper 模型大小（`WHISPER_MODEL`），以在速度和准确度之间取得平衡。<br>- 支持在不同的计算设备（`WHISPER_DEVICE`: CPU/CUDA）上运行。 | **高** |
| F-003 | **实时翻译** | - 将语音识别出的英文文本实时翻译成指定的目标语言（默认为简体中文 `zh-CN`）。<br>- 支持集成多种翻译服务提供商，默认为 Kimi AI，可选 OpenAI。<br>- 用户需在 `.env` 文件中配置所选服务的 `API_KEY`。 | **高** |
| F-004 | **悬浮字幕显示** | - 以一个桌面悬浮窗的形式实时显示翻译后的字幕。<br>- 字幕窗口应始终置顶于其他应用程序之上。<br>- 支持更新字幕内容。 | **高** |

### 2.2. 用户界面与交互

| **ID** | **功能名称** | **描述** | **优先级** |
| :--- | :--- | :--- | :--- |
| F-005 | **窗口可拖拽** | 用户可以通过鼠标按住并拖动字幕悬浮窗，将其放置在屏幕的任意位置。 | **高** |
| F-006 | **自定义字幕样式** | 用户可通过修改 `.env` 文件自定义字幕的：<br>- 字体大小 (`SUBTITLE_FONT_SIZE`)<br>- 字体颜色 (`SUBTITLE_FONT_COLOR`)<br>- 背景颜色 (`SUBTITLE_BG_COLOR`)<br>- 窗口不透明度 (`SUBTITLE_OPACITY`)<br>- 初始位置 (`SUBTITLE_POSITION`) | **中** |
| F-007 | **程序控制** | - 用户可通过 `ESC` 键或 `Ctrl+C` 快捷键优雅地退出应用程序。<br>- 支持通过快捷键（如 `Cmd+Shift+T`）快速显示/隐藏字幕窗口。<br>- 支持通过快捷键（如 `Cmd+Shift+R`）重新加载配置。 | **中** |

### 2.3. 配置与管理

| **ID** | **功能名称** | **描述** | **优先级** |
| :--- | :--- | :--- | :--- |
| F-008 | **环境变量配置** | - 所有关键配置项（如 API 密钥、模型选择、样式等）均通过根目录下的 `.env` 文件进行管理。<br>- 提供 `env.example` 作为模板，方便用户创建自己的配置文件。 | **高** |
| F-009 | **日志系统** | - 程序运行过程中产生的关键信息（如识别原文、翻译结果、错误信息）需记录到日志中。<br>- 在 `logs/` 目录下生成带时间戳的日志文件，用于问题排查和内容回顾。<br>- 支持在控制台实时输出日志。 | **高** |

## 3. 非功能需求 (Non-Functional Requirements)

| **ID** | **需求类型** | **描述** | **优先级** |
| :--- | :--- | :--- | :--- |
| NF-001 | **性能** | **延迟**: 从音频输入到字幕显示的端到端延迟应控制在 500ms 以内（使用 `base` 模型时）。<br>**资源占用**: 内存占用应与所选的 Whisper 模型大小相匹配（例如，`base` 模型约 500MB）。 | **高** |
| NF-002 | **兼容性** | **操作系统**: 必须兼容 macOS 10.15 及以上版本。<br>**Python 版本**: 要求 Python 3.8+。<br>**音频驱动**: 依赖 BlackHole 或 Soundflower 等虚拟音频驱动。 | **高** |
| NF-003 | **可靠性** | **错误恢复**: 当遇到 API 请求失败或网络问题时，应具备自动重试机制。<br>**稳定性**: 程序应能长时间稳定运行，避免内存泄漏或崩溃。 | **中** |
| NF-004 | **可扩展性** | 代码架构应清晰、模块化，方便未来：<br>- 增加新的翻译引擎（继承 `BaseTranslator`）。<br>- 增加新的显示方式（继承 `BaseOverlay`）。 | **低** |
| NF-005 | **安全性** | 用户的 API 密钥等敏感信息仅存储在本地的 `.env` 文件中，并已加入 `.gitignore`，确保不会被意外提交到版本控制系统。 | **高** |

## 4. 未来规划 (Future Scope)

*   **多语言支持**：扩展支持更多源语言和目标语言的翻译。
*   **GUI 配置界面**：开发一个图形用户界面，让用户可以直接在应用内修改配置，而无需编辑 `.env` 文件。
*   **字幕历史记录**：在悬浮窗内提供一个可滚动的区域，展示最近几条字幕的历史记录。
*   **Windows 和 Linux 支持**：将应用移植到 Windows 和 Linux 平台，扩大用户群体。
*   **本地化模型**：探索使用完全在本地运行的翻译模型，以消除对外部 API 的依赖和网络延迟。 